var fe=Object.defineProperty;var de=(t,e,n)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var J=(t,e,n)=>de(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function y(){}function ae(t){return t()}function ee(){return Object.create(null)}function B(t){t.forEach(ae)}function ce(t){return typeof t=="function"}function I(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function me(t){return Object.keys(t).length===0}function d(t,e){t.appendChild(e)}function w(t,e,n){t.insertBefore(e,n||null)}function v(t){t.parentNode&&t.parentNode.removeChild(t)}function he(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function S(t){return document.createTextNode(t)}function k(){return S(" ")}function ge(){return S("")}function D(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function g(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function pe(t){return Array.from(t.childNodes)}function H(t,e){e=""+e,t.data!==e&&(t.data=e)}function G(t,e){t.value=e??""}function _e(t,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:s})}let K;function F(t){K=t}function x(){if(!K)throw new Error("Function called outside component initialization");return K}function be(t){x().$$.on_mount.push(t)}function ve(t){x().$$.after_update.push(t)}function $e(){const t=x();return(e,n,{cancelable:s=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=_e(e,n,{cancelable:s});return i.slice().forEach(l=>{l.call(t,r)}),!r.defaultPrevented}return!0}}const q=[],X=[];let M=[];const te=[],we=Promise.resolve();let Y=!1;function ye(){Y||(Y=!0,we.then(ue))}function Z(t){M.push(t)}const V=new Set;let R=0;function ue(){if(R!==0)return;const t=K;do{try{for(;R<q.length;){const e=q[R];R++,F(e),ke(e.$$)}}catch(e){throw q.length=0,R=0,e}for(F(null),q.length=0,R=0;X.length;)X.pop()();for(let e=0;e<M.length;e+=1){const n=M[e];V.has(n)||(V.add(n),n())}M.length=0}while(q.length);for(;te.length;)te.pop()();Y=!1,V.clear(),F(t)}function ke(t){if(t.fragment!==null){t.update(),B(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Z)}}function Se(t){const e=[],n=[];M.forEach(s=>t.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),M=e}const W=new Set;let O;function Le(){O={r:0,c:[],p:O}}function Ee(){O.r||B(O.c),O=O.p}function E(t,e){t&&t.i&&(W.delete(t),t.i(e))}function C(t,e,n,s){if(t&&t.o){if(W.has(t))return;W.add(t),O.c.push(()=>{W.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function ne(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function U(t){t&&t.c()}function A(t,e,n){const{fragment:s,after_update:i}=t.$$;s&&s.m(e,n),Z(()=>{const r=t.$$.on_mount.map(ae).filter(ce);t.$$.on_destroy?t.$$.on_destroy.push(...r):B(r),t.$$.on_mount=[]}),i.forEach(Z)}function N(t,e){const n=t.$$;n.fragment!==null&&(Se(n.after_update),B(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ce(t,e){t.$$.dirty[0]===-1&&(q.push(t),ye(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function P(t,e,n,s,i,r,l=null,a=[-1]){const c=K;F(t);const o=t.$$={fragment:null,ctx:[],props:r,update:y,not_equal:i,bound:ee(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:ee(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};l&&l(o.root);let h=!1;if(o.ctx=n?n(t,e.props||{},(f,u,...m)=>{const b=m.length?m[0]:u;return o.ctx&&i(o.ctx[f],o.ctx[f]=b)&&(!o.skip_bound&&o.bound[f]&&o.bound[f](b),h&&Ce(t,f)),u}):[],o.update(),h=!0,B(o.before_update),o.fragment=s?s(o.ctx):!1,e.target){if(e.hydrate){const f=pe(e.target);o.fragment&&o.fragment.l(f),f.forEach(v)}else o.fragment&&o.fragment.c();e.intro&&E(t.$$.fragment),A(t,e.target,e.anchor),ue()}F(c)}class z{constructor(){J(this,"$$");J(this,"$$set")}$destroy(){N(this,1),this.$destroy=y}$on(e,n){if(!ce(n))return y;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!me(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ie="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ie);const T=[];function Oe(t,e=y){let n;const s=new Set;function i(a){if(I(t,a)&&(t=a,n)){const c=!T.length;for(const o of s)o[1](),T.push(o,t);if(c){for(let o=0;o<T.length;o+=2)T[o][0](T[o+1]);T.length=0}}}function r(a){i(a(t))}function l(a,c=y){const o=[a,c];return s.add(o),s.size===1&&(n=e(i,r)||y),a(t),()=>{s.delete(o),s.size===0&&n&&(n(),n=null)}}return{set:i,update:r,subscribe:l}}const Q="https://qsmdcp3sr1.execute-api.ap-northeast-1.amazonaws.com/prod",se={async buildRag(t){const e=await fetch(`${Q}/rag/build`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})});if(!e.ok)throw new Error("Failed to start RAG build");return await e.json()},async checkStatus(t){const e=await fetch(`${Q}/rag/${t}/status`);if(!e.ok)throw new Error("Failed to check status");return await e.json()},async chatQuery(t,e){const n=await fetch(`${Q}/chat/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,query:e})});if(!n.ok)throw new Error("Failed to send query");return await n.json()},async getHistory(t){const e=await fetch(`${Q}/chat/${t}/history`);if(!e.ok)throw new Error("Failed to fetch history");return await e.json()}};function Ae(){const{subscribe:t,update:e,set:n}=Oe({sessionId:null,messages:[],isLoading:!1,error:null,ragStatus:"idle"});return{subscribe:t,setSessionId:s=>e(i=>({...i,sessionId:s})),addMessage:(s,i)=>e(r=>({...r,messages:[...r.messages,{role:s,content:i,timestamp:new Date}]})),async buildRag(s){e(i=>({...i,isLoading:!0,error:null,ragStatus:"building"}));try{const i=await se.buildRag(s);return e(r=>({...r,sessionId:i.session_id,ragStatus:i.status,isLoading:!1})),i}catch(i){throw e(r=>({...r,isLoading:!1,error:i.message,ragStatus:"error"})),i}},async sendQuery(s){e(i=>({...i,isLoading:!0,messages:[...i.messages,{role:"user",content:s,timestamp:new Date}]}));try{let i;if(t(l=>i=l)(),!i.sessionId)throw new Error("No active session");const r=await se.chatQuery(i.sessionId,s);e(l=>({...l,isLoading:!1,messages:[...l.messages,{role:"assistant",content:r.response,timestamp:new Date}]}))}catch(i){e(r=>({...r,isLoading:!1,messages:[...r.messages,{role:"system",content:`Error: ${i.message}`,isError:!0}]}))}},reset:()=>n({sessionId:null,messages:[],isLoading:!1,error:null,ragStatus:"idle"})}}const j=Ae();function Ne(t){let e;return{c(){e=S("Start")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function je(t){let e;return{c(){e=S("Building...")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function Be(t){let e,n,s,i,r,l,a,c,o,h,f,u;function m($,L){return $[0]?je:Ne}let b=m(t),_=b(t);return{c(){e=p("div"),n=p("h2"),n.textContent="Build Knowledge Base",s=k(),i=p("p"),i.textContent="Enter a Wikipedia URL to start chatting with it.",r=k(),l=p("div"),a=p("input"),c=k(),o=p("button"),_.c(),g(n,"class","svelte-dlfvc8"),g(i,"class","svelte-dlfvc8"),g(a,"type","url"),g(a,"placeholder","https://en.wikipedia.org/wiki/..."),a.disabled=t[0],g(a,"class","svelte-dlfvc8"),o.disabled=h=!t[1]||t[0],g(o,"class","svelte-dlfvc8"),g(l,"class","input-group svelte-dlfvc8"),g(e,"class","wiki-input svelte-dlfvc8")},m($,L){w($,e,L),d(e,n),d(e,s),d(e,i),d(e,r),d(e,l),d(l,a),G(a,t[1]),d(l,c),d(l,o),_.m(o,null),f||(u=[D(a,"input",t[3]),D(o,"click",t[2])],f=!0)},p($,[L]){L&1&&(a.disabled=$[0]),L&2&&a.value!==$[1]&&G(a,$[1]),b!==(b=m($))&&(_.d(1),_=b($),_&&(_.c(),_.m(o,null))),L&3&&h!==(h=!$[1]||$[0])&&(o.disabled=h)},i:y,o:y,d($){$&&v(e),_.d(),f=!1,B(u)}}}function Pe(t,e,n){let{isLoading:s=!1}=e,i="";const r=$e();function l(){!i||s||r("submit",{url:i})}function a(){i=this.value,n(1,i)}return t.$$set=c=>{"isLoading"in c&&n(0,s=c.isLoading)},[s,i,l,a]}class ze extends z{constructor(e){super(),P(this,e,Pe,Be,I,{isLoading:0})}}function ie(t){let e,n,s,i,r,l=t[0].toUpperCase()+"",a,c,o;function h(b,_){if(b[0]==="building")return qe;if(b[0]==="ready")return Te;if(b[0]==="error")return Re}let f=h(t),u=f&&f(t),m=t[1]&&re(t);return{c(){e=p("div"),n=p("div"),u&&u.c(),s=k(),i=p("div"),r=p("strong"),a=S(l),c=k(),m&&m.c(),g(n,"class","icon svelte-151cihv"),g(i,"class","text"),g(e,"class",o="status-indicator "+t[0]+" svelte-151cihv")},m(b,_){w(b,e,_),d(e,n),u&&u.m(n,null),d(e,s),d(e,i),d(i,r),d(r,a),d(i,c),m&&m.m(i,null)},p(b,_){f!==(f=h(b))&&(u&&u.d(1),u=f&&f(b),u&&(u.c(),u.m(n,null))),_&1&&l!==(l=b[0].toUpperCase()+"")&&H(a,l),b[1]?m?m.p(b,_):(m=re(b),m.c(),m.m(i,null)):m&&(m.d(1),m=null),_&1&&o!==(o="status-indicator "+b[0]+" svelte-151cihv")&&g(e,"class",o)},d(b){b&&v(e),u&&u.d(),m&&m.d()}}}function Re(t){let e;return{c(){e=S("âŒ")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function Te(t){let e;return{c(){e=S("âœ…")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function qe(t){let e;return{c(){e=S("ðŸ”„")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function re(t){let e,n,s;return{c(){e=p("span"),n=S(": "),s=S(t[1])},m(i,r){w(i,e,r),d(e,n),d(e,s)},p(i,r){r&2&&H(s,i[1])},d(i){i&&v(e)}}}function De(t){let e,n=t[0]!=="idle"&&ie(t);return{c(){n&&n.c(),e=ge()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,[i]){s[0]!=="idle"?n?n.p(s,i):(n=ie(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:y,o:y,d(s){s&&v(e),n&&n.d(s)}}}function Me(t,e,n){let{status:s="idle"}=e,{message:i=""}=e;return t.$$set=r=>{"status"in r&&n(0,s=r.status),"message"in r&&n(1,i=r.message)},[s,i]}class Ue extends z{constructor(e){super(),P(this,e,Me,De,I,{status:0,message:1})}}function Fe(t){let e,n,s,i,r,l,a,c;return r=new ze({props:{isLoading:t[0]==="building"}}),r.$on("submit",t[2]),a=new Ue({props:{status:t[0],message:t[1]}}),{c(){e=p("div"),n=p("header"),n.innerHTML='<h1 class="svelte-ech64h">Wikipedia RAG ðŸ¤–</h1> <p class="svelte-ech64h">Chat with any Wikipedia article!</p>',s=k(),i=p("main"),U(r.$$.fragment),l=k(),U(a.$$.fragment),g(n,"class","svelte-ech64h"),g(i,"class","svelte-ech64h"),g(e,"class","index-page svelte-ech64h")},m(o,h){w(o,e,h),d(e,n),d(e,s),d(e,i),A(r,i,null),d(i,l),A(a,i,null),c=!0},p(o,[h]){const f={};h&1&&(f.isLoading=o[0]==="building"),r.$set(f);const u={};h&1&&(u.status=o[0]),h&2&&(u.message=o[1]),a.$set(u)},i(o){c||(E(r.$$.fragment,o),E(a.$$.fragment,o),c=!0)},o(o){C(r.$$.fragment,o),C(a.$$.fragment,o),c=!1},d(o){o&&v(e),N(r),N(a)}}}function Ke(t,e,n){let s="idle",i="";j.subscribe(l=>{n(0,s=l.ragStatus),n(1,i=l.error||"")});function r(l){const{url:a}=l.detail;j.buildRag(a).catch(c=>{console.error("Build failed",c)})}return[s,i,r]}class Qe extends z{constructor(e){super(),P(this,e,Ke,Fe,I,{})}}function le(t,e,n){const s=t.slice();return s[3]=e[n],s}function oe(t){let e,n,s,i=t[3].content+"",r,l,a,c=new Date(t[3].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})+"",o,h,f;return{c(){e=p("div"),n=p("div"),s=p("div"),r=S(i),l=k(),a=p("div"),o=S(c),h=k(),g(s,"class","content"),g(a,"class","time svelte-1dnvvz0"),g(n,"class","bubble svelte-1dnvvz0"),g(e,"class",f="message "+t[3].role+" svelte-1dnvvz0")},m(u,m){w(u,e,m),d(e,n),d(n,s),d(s,r),d(n,l),d(n,a),d(a,o),d(e,h)},p(u,m){m&1&&i!==(i=u[3].content+"")&&H(r,i),m&1&&c!==(c=new Date(u[3].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})+"")&&H(o,c),m&1&&f!==(f="message "+u[3].role+" svelte-1dnvvz0")&&g(e,"class",f)},d(u){u&&v(e)}}}function We(t){let e,n=ne(t[0]),s=[];for(let i=0;i<n.length;i+=1)s[i]=oe(le(t,n,i));return{c(){e=p("div");for(let i=0;i<s.length;i+=1)s[i].c();g(e,"class","message-list svelte-1dnvvz0")},m(i,r){w(i,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);t[2](e)},p(i,[r]){if(r&1){n=ne(i[0]);let l;for(l=0;l<n.length;l+=1){const a=le(i,n,l);s[l]?s[l].p(a,r):(s[l]=oe(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},i:y,o:y,d(i){i&&v(e),he(s,i),t[2](null)}}}function He(t,e,n){let{messages:s=[]}=e,i;ve(()=>{i&&n(1,i.scrollTop=i.scrollHeight,i)});function r(l){X[l?"unshift":"push"](()=>{i=l,n(1,i)})}return t.$$set=l=>{"messages"in l&&n(0,s=l.messages)},[s,i,r]}class Ge extends z{constructor(e){super(),P(this,e,He,We,I,{messages:0})}}function Je(t){let e;return{c(){e=S("Send")},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function Ve(t){let e;return{c(){e=p("span"),e.textContent="..."},m(n,s){w(n,e,s)},d(n){n&&v(e)}}}function Xe(t){let e,n,s,i,r,l,a,c;function o(u,m){return u[1]?Ve:Je}let h=o(t),f=h(t);return{c(){e=p("div"),n=p("div"),s=p("textarea"),i=k(),r=p("button"),f.c(),g(s,"placeholder","Ask a question about the article..."),s.disabled=t[1],g(s,"class","svelte-1owg012"),r.disabled=l=!t[0].trim()||t[1],g(r,"class","svelte-1owg012"),g(n,"class","input-container svelte-1owg012"),g(e,"class","chat-interface svelte-1owg012")},m(u,m){w(u,e,m),d(e,n),d(n,s),G(s,t[0]),d(n,i),d(n,r),f.m(r,null),a||(c=[D(s,"input",t[4]),D(s,"keydown",t[3]),D(r,"click",t[2])],a=!0)},p(u,[m]){m&2&&(s.disabled=u[1]),m&1&&G(s,u[0]),h!==(h=o(u))&&(f.d(1),f=h(u),f&&(f.c(),f.m(r,null))),m&3&&l!==(l=!u[0].trim()||u[1])&&(r.disabled=l)},i:y,o:y,d(u){u&&v(e),f.d(),a=!1,B(c)}}}function Ye(t,e,n){let s="",i;j.subscribe(c=>{n(1,i=c.isLoading)});function r(){!s.trim()||i||(j.sendQuery(s),n(0,s=""))}function l(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),r())}function a(){s=this.value,n(0,s)}return[s,i,r,l,a]}class Ze extends z{constructor(e){super(),P(this,e,Ye,Xe,I,{})}}function xe(t){let e,n,s,i,r,l,a,c,o,h,f,u,m,b;return c=new Ge({props:{messages:t[0]}}),f=new Ze({}),{c(){e=p("div"),n=p("header"),s=p("button"),s.textContent="â† Back",i=k(),r=p("h1"),r.textContent="Chat Session",l=k(),a=p("main"),U(c.$$.fragment),o=k(),h=p("footer"),U(f.$$.fragment),g(s,"class","back-btn svelte-vs03v3"),g(r,"class","svelte-vs03v3"),g(n,"class","svelte-vs03v3"),g(a,"class","svelte-vs03v3"),g(e,"class","chat-page svelte-vs03v3")},m(_,$){w(_,e,$),d(e,n),d(n,s),d(n,i),d(n,r),d(e,l),d(e,a),A(c,a,null),d(e,o),d(e,h),A(f,h,null),u=!0,m||(b=D(s,"click",t[1]),m=!0)},p(_,[$]){const L={};$&1&&(L.messages=_[0]),c.$set(L)},i(_){u||(E(c.$$.fragment,_),E(f.$$.fragment,_),u=!0)},o(_){C(c.$$.fragment,_),C(f.$$.fragment,_),u=!1},d(_){_&&v(e),N(c),N(f),m=!1,b()}}}function et(t,e,n){let s=[];j.subscribe(r=>{n(0,s=r.messages),r.sessionId}),be(()=>{});function i(){j.reset()}return[s,i]}class tt extends z{constructor(e){super(),P(this,e,et,xe,I,{})}}function nt(t){let e,n;return e=new Qe({}),{c(){U(e.$$.fragment)},m(s,i){A(e,s,i),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function st(t){let e,n;return e=new tt({}),{c(){U(e.$$.fragment)},m(s,i){A(e,s,i),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function it(t){let e,n,s,i;const r=[st,nt],l=[];function a(c,o){return c[0]?0:1}return n=a(t),s=l[n]=r[n](t),{c(){e=p("main"),s.c(),g(e,"class","svelte-fu7pfu")},m(c,o){w(c,e,o),l[n].m(e,null),i=!0},p(c,[o]){let h=n;n=a(c),n!==h&&(Le(),C(l[h],1,1,()=>{l[h]=null}),Ee(),s=l[n],s||(s=l[n]=r[n](c),s.c()),E(s,1),s.m(e,null))},i(c){i||(E(s),i=!0)},o(c){C(s),i=!1},d(c){c&&v(e),l[n].d()}}}function rt(t,e,n){let s;return j.subscribe(i=>{n(0,s=i.sessionId)}),[s]}class lt extends z{constructor(e){super(),P(this,e,rt,it,I,{})}}new lt({target:document.getElementById("app")});
