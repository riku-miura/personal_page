var fe=Object.defineProperty;var de=(t,e,n)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var J=(t,e,n)=>de(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function w(){}function ae(t){return t()}function ee(){return Object.create(null)}function P(t){t.forEach(ae)}function ue(t){return typeof t=="function"}function I(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function me(t){return Object.keys(t).length===0}function d(t,e){t.appendChild(e)}function y(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function he(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function S(t){return document.createTextNode(t)}function k(){return S(" ")}function pe(){return S("")}function D(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ge(t){return Array.from(t.childNodes)}function H(t,e){e=""+e,t.data!==e&&(t.data=e)}function G(t,e){t.value=e??""}function _e(t,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:s})}let K;function F(t){K=t}function x(){if(!K)throw new Error("Function called outside component initialization");return K}function be(t){x().$$.on_mount.push(t)}function $e(t){x().$$.after_update.push(t)}function ve(){const t=x();return(e,n,{cancelable:s=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=_e(e,n,{cancelable:s});return i.slice().forEach(l=>{l.call(t,r)}),!r.defaultPrevented}return!0}}const q=[],X=[];let M=[];const te=[],ye=Promise.resolve();let Y=!1;function we(){Y||(Y=!0,ye.then(ce))}function Z(t){M.push(t)}const V=new Set;let z=0;function ce(){if(z!==0)return;const t=K;do{try{for(;z<q.length;){const e=q[z];z++,F(e),ke(e.$$)}}catch(e){throw q.length=0,z=0,e}for(F(null),q.length=0,z=0;X.length;)X.pop()();for(let e=0;e<M.length;e+=1){const n=M[e];V.has(n)||(V.add(n),n())}M.length=0}while(q.length);for(;te.length;)te.pop()();Y=!1,V.clear(),F(t)}function ke(t){if(t.fragment!==null){t.update(),P(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Z)}}function Se(t){const e=[],n=[];M.forEach(s=>t.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),M=e}const W=new Set;let j;function Le(){j={r:0,c:[],p:j}}function Ee(){j.r||P(j.c),j=j.p}function E(t,e){t&&t.i&&(W.delete(t),t.i(e))}function C(t,e,n,s){if(t&&t.o){if(W.has(t))return;W.add(t),j.c.push(()=>{W.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function ne(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function U(t){t&&t.c()}function O(t,e,n){const{fragment:s,after_update:i}=t.$$;s&&s.m(e,n),Z(()=>{const r=t.$$.on_mount.map(ae).filter(ue);t.$$.on_destroy?t.$$.on_destroy.push(...r):P(r),t.$$.on_mount=[]}),i.forEach(Z)}function A(t,e){const n=t.$$;n.fragment!==null&&(Se(n.after_update),P(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ce(t,e){t.$$.dirty[0]===-1&&(q.push(t),we(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function B(t,e,n,s,i,r,l=null,a=[-1]){const u=K;F(t);const o=t.$$={fragment:null,ctx:[],props:r,update:w,not_equal:i,bound:ee(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:ee(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};l&&l(o.root);let h=!1;if(o.ctx=n?n(t,e.props||{},(f,c,...m)=>{const b=m.length?m[0]:c;return o.ctx&&i(o.ctx[f],o.ctx[f]=b)&&(!o.skip_bound&&o.bound[f]&&o.bound[f](b),h&&Ce(t,f)),c}):[],o.update(),h=!0,P(o.before_update),o.fragment=s?s(o.ctx):!1,e.target){if(e.hydrate){const f=ge(e.target);o.fragment&&o.fragment.l(f),f.forEach($)}else o.fragment&&o.fragment.c();e.intro&&E(t.$$.fragment),O(t,e.target,e.anchor),ce()}F(u)}class R{constructor(){J(this,"$$");J(this,"$$set")}$destroy(){A(this,1),this.$destroy=w}$on(e,n){if(!ue(n))return w;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!me(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ie="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ie);const T=[];function je(t,e=w){let n;const s=new Set;function i(a){if(I(t,a)&&(t=a,n)){const u=!T.length;for(const o of s)o[1](),T.push(o,t);if(u){for(let o=0;o<T.length;o+=2)T[o][0](T[o+1]);T.length=0}}}function r(a){i(a(t))}function l(a,u=w){const o=[a,u];return s.add(o),s.size===1&&(n=e(i,r)||w),a(t),()=>{s.delete(o),s.size===0&&n&&(n(),n=null)}}return{set:i,update:r,subscribe:l}}const Q="https://qsmdcp3sr1.execute-api.ap-northeast-1.amazonaws.com/prod",se={async buildRag(t){const e=await fetch(`${Q}/rag/build`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})});if(!e.ok)throw new Error("Failed to start RAG build");return await e.json()},async checkStatus(t){const e=await fetch(`${Q}/rag/${t}/status`);if(!e.ok)throw new Error("Failed to check status");return await e.json()},async chatQuery(t,e){const n=await fetch(`${Q}/chat/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,query:e})});if(!n.ok)throw new Error("Failed to send query");return await n.json()},async getHistory(t){const e=await fetch(`${Q}/chat/${t}/history`);if(!e.ok)throw new Error("Failed to fetch history");return await e.json()}};function Oe(){const{subscribe:t,update:e,set:n}=je({sessionId:null,messages:[],isLoading:!1,error:null,ragStatus:"idle"});return{subscribe:t,setSessionId:s=>e(i=>({...i,sessionId:s})),addMessage:(s,i)=>e(r=>({...r,messages:[...r.messages,{role:s,content:i,timestamp:new Date}]})),async buildRag(s){e(i=>({...i,isLoading:!0,error:null,ragStatus:"building"}));try{const i=await se.buildRag(s);return e(r=>({...r,sessionId:i.session_id,ragStatus:i.status,isLoading:!1})),i}catch(i){throw e(r=>({...r,isLoading:!1,error:i.message,ragStatus:"error"})),i}},async sendQuery(s){e(i=>({...i,isLoading:!0,messages:[...i.messages,{role:"user",content:s,timestamp:new Date}]}));try{let i;if(t(l=>i=l)(),!i.sessionId)throw new Error("No active session");const r=await se.chatQuery(i.sessionId,s);e(l=>({...l,isLoading:!1,messages:[...l.messages,{role:"assistant",content:r.response,timestamp:new Date}]}))}catch(i){e(r=>({...r,isLoading:!1,messages:[...r.messages,{role:"system",content:`Error: ${i.message}`,isError:!0}]}))}},reset:()=>n({sessionId:null,messages:[],isLoading:!1,error:null,ragStatus:"idle"})}}const N=Oe();function Ae(t){let e;return{c(){e=S("Start")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function Ne(t){let e;return{c(){e=S("Building...")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function Pe(t){let e,n,s,i,r,l,a,u,o,h,f,c;function m(v,L){return v[0]?Ne:Ae}let b=m(t),_=b(t);return{c(){e=g("div"),n=g("h2"),n.textContent="Build Knowledge Base",s=k(),i=g("p"),i.textContent="Enter a Wikipedia URL to start chatting with it.",r=k(),l=g("div"),a=g("input"),u=k(),o=g("button"),_.c(),p(n,"class","svelte-nejir8"),p(i,"class","svelte-nejir8"),p(a,"type","url"),p(a,"placeholder","https://en.wikipedia.org/wiki/..."),a.disabled=t[0],p(a,"class","svelte-nejir8"),o.disabled=h=!t[1]||t[0],p(o,"class","svelte-nejir8"),p(l,"class","input-group svelte-nejir8"),p(e,"class","wiki-input svelte-nejir8")},m(v,L){y(v,e,L),d(e,n),d(e,s),d(e,i),d(e,r),d(e,l),d(l,a),G(a,t[1]),d(l,u),d(l,o),_.m(o,null),f||(c=[D(a,"input",t[3]),D(o,"click",t[2])],f=!0)},p(v,[L]){L&1&&(a.disabled=v[0]),L&2&&a.value!==v[1]&&G(a,v[1]),b!==(b=m(v))&&(_.d(1),_=b(v),_&&(_.c(),_.m(o,null))),L&3&&h!==(h=!v[1]||v[0])&&(o.disabled=h)},i:w,o:w,d(v){v&&$(e),_.d(),f=!1,P(c)}}}function Be(t,e,n){let{isLoading:s=!1}=e,i="";const r=ve();function l(){!i||s||r("submit",{url:i})}function a(){i=this.value,n(1,i)}return t.$$set=u=>{"isLoading"in u&&n(0,s=u.isLoading)},[s,i,l,a]}class Re extends R{constructor(e){super(),B(this,e,Be,Pe,I,{isLoading:0})}}function ie(t){let e,n,s,i,r,l=t[0].toUpperCase()+"",a,u,o;function h(b,_){if(b[0]==="building")return qe;if(b[0]==="ready")return Te;if(b[0]==="error")return ze}let f=h(t),c=f&&f(t),m=t[1]&&re(t);return{c(){e=g("div"),n=g("div"),c&&c.c(),s=k(),i=g("div"),r=g("strong"),a=S(l),u=k(),m&&m.c(),p(n,"class","icon svelte-mfr2pw"),p(i,"class","text"),p(e,"class",o="status-indicator "+t[0]+" svelte-mfr2pw")},m(b,_){y(b,e,_),d(e,n),c&&c.m(n,null),d(e,s),d(e,i),d(i,r),d(r,a),d(i,u),m&&m.m(i,null)},p(b,_){f!==(f=h(b))&&(c&&c.d(1),c=f&&f(b),c&&(c.c(),c.m(n,null))),_&1&&l!==(l=b[0].toUpperCase()+"")&&H(a,l),b[1]?m?m.p(b,_):(m=re(b),m.c(),m.m(i,null)):m&&(m.d(1),m=null),_&1&&o!==(o="status-indicator "+b[0]+" svelte-mfr2pw")&&p(e,"class",o)},d(b){b&&$(e),c&&c.d(),m&&m.d()}}}function ze(t){let e;return{c(){e=S("Error")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function Te(t){let e;return{c(){e=S("Ready")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function qe(t){let e;return{c(){e=S("Processing...")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function re(t){let e,n,s;return{c(){e=g("span"),n=S(": "),s=S(t[1])},m(i,r){y(i,e,r),d(e,n),d(e,s)},p(i,r){r&2&&H(s,i[1])},d(i){i&&$(e)}}}function De(t){let e,n=t[0]!=="idle"&&ie(t);return{c(){n&&n.c(),e=pe()},m(s,i){n&&n.m(s,i),y(s,e,i)},p(s,[i]){s[0]!=="idle"?n?n.p(s,i):(n=ie(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:w,o:w,d(s){s&&$(e),n&&n.d(s)}}}function Me(t,e,n){let{status:s="idle"}=e,{message:i=""}=e;return t.$$set=r=>{"status"in r&&n(0,s=r.status),"message"in r&&n(1,i=r.message)},[s,i]}class Ue extends R{constructor(e){super(),B(this,e,Me,De,I,{status:0,message:1})}}function Fe(t){let e,n,s,i,r,l,a,u;return r=new Re({props:{isLoading:t[0]==="building"}}),r.$on("submit",t[2]),a=new Ue({props:{status:t[0],message:t[1]}}),{c(){e=g("div"),n=g("header"),n.innerHTML='<h1 class="svelte-ech64h">Wikipedia RAG ðŸ¤–</h1> <p class="svelte-ech64h">Chat with any Wikipedia article!</p>',s=k(),i=g("main"),U(r.$$.fragment),l=k(),U(a.$$.fragment),p(n,"class","svelte-ech64h"),p(i,"class","svelte-ech64h"),p(e,"class","index-page svelte-ech64h")},m(o,h){y(o,e,h),d(e,n),d(e,s),d(e,i),O(r,i,null),d(i,l),O(a,i,null),u=!0},p(o,[h]){const f={};h&1&&(f.isLoading=o[0]==="building"),r.$set(f);const c={};h&1&&(c.status=o[0]),h&2&&(c.message=o[1]),a.$set(c)},i(o){u||(E(r.$$.fragment,o),E(a.$$.fragment,o),u=!0)},o(o){C(r.$$.fragment,o),C(a.$$.fragment,o),u=!1},d(o){o&&$(e),A(r),A(a)}}}function Ke(t,e,n){let s="idle",i="";N.subscribe(l=>{n(0,s=l.ragStatus),n(1,i=l.error||"")});function r(l){const{url:a}=l.detail;N.buildRag(a).catch(u=>{console.error("Build failed",u)})}return[s,i,r]}class Qe extends R{constructor(e){super(),B(this,e,Ke,Fe,I,{})}}function le(t,e,n){const s=t.slice();return s[3]=e[n],s}function oe(t){let e,n,s,i=t[3].content+"",r,l,a,u=new Date(t[3].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})+"",o,h,f;return{c(){e=g("div"),n=g("div"),s=g("div"),r=S(i),l=k(),a=g("div"),o=S(u),h=k(),p(s,"class","content"),p(a,"class","time svelte-1elkl4a"),p(n,"class","bubble svelte-1elkl4a"),p(e,"class",f="message "+t[3].role+" svelte-1elkl4a")},m(c,m){y(c,e,m),d(e,n),d(n,s),d(s,r),d(n,l),d(n,a),d(a,o),d(e,h)},p(c,m){m&1&&i!==(i=c[3].content+"")&&H(r,i),m&1&&u!==(u=new Date(c[3].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})+"")&&H(o,u),m&1&&f!==(f="message "+c[3].role+" svelte-1elkl4a")&&p(e,"class",f)},d(c){c&&$(e)}}}function We(t){let e,n=ne(t[0]),s=[];for(let i=0;i<n.length;i+=1)s[i]=oe(le(t,n,i));return{c(){e=g("div");for(let i=0;i<s.length;i+=1)s[i].c();p(e,"class","message-list svelte-1elkl4a")},m(i,r){y(i,e,r);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null);t[2](e)},p(i,[r]){if(r&1){n=ne(i[0]);let l;for(l=0;l<n.length;l+=1){const a=le(i,n,l);s[l]?s[l].p(a,r):(s[l]=oe(a),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},i:w,o:w,d(i){i&&$(e),he(s,i),t[2](null)}}}function He(t,e,n){let{messages:s=[]}=e,i;$e(()=>{i&&n(1,i.scrollTop=i.scrollHeight,i)});function r(l){X[l?"unshift":"push"](()=>{i=l,n(1,i)})}return t.$$set=l=>{"messages"in l&&n(0,s=l.messages)},[s,i,r]}class Ge extends R{constructor(e){super(),B(this,e,He,We,I,{messages:0})}}function Je(t){let e;return{c(){e=S("Send")},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function Ve(t){let e;return{c(){e=g("span"),e.textContent="..."},m(n,s){y(n,e,s)},d(n){n&&$(e)}}}function Xe(t){let e,n,s,i,r,l,a,u;function o(c,m){return c[1]?Ve:Je}let h=o(t),f=h(t);return{c(){e=g("div"),n=g("div"),s=g("textarea"),i=k(),r=g("button"),f.c(),p(s,"placeholder","Ask a question about the article..."),s.disabled=t[1],p(s,"class","svelte-dzthly"),r.disabled=l=!t[0].trim()||t[1],p(r,"class","svelte-dzthly"),p(n,"class","input-container svelte-dzthly"),p(e,"class","chat-interface svelte-dzthly")},m(c,m){y(c,e,m),d(e,n),d(n,s),G(s,t[0]),d(n,i),d(n,r),f.m(r,null),a||(u=[D(s,"input",t[4]),D(s,"keydown",t[3]),D(r,"click",t[2])],a=!0)},p(c,[m]){m&2&&(s.disabled=c[1]),m&1&&G(s,c[0]),h!==(h=o(c))&&(f.d(1),f=h(c),f&&(f.c(),f.m(r,null))),m&3&&l!==(l=!c[0].trim()||c[1])&&(r.disabled=l)},i:w,o:w,d(c){c&&$(e),f.d(),a=!1,P(u)}}}function Ye(t,e,n){let s="",i;N.subscribe(u=>{n(1,i=u.isLoading)});function r(){!s.trim()||i||(N.sendQuery(s),n(0,s=""))}function l(u){u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),r())}function a(){s=this.value,n(0,s)}return[s,i,r,l,a]}class Ze extends R{constructor(e){super(),B(this,e,Ye,Xe,I,{})}}function xe(t){let e,n,s,i,r,l,a,u,o,h,f,c,m,b;return u=new Ge({props:{messages:t[0]}}),f=new Ze({}),{c(){e=g("div"),n=g("header"),s=g("button"),s.textContent="â† Back",i=k(),r=g("h1"),r.textContent="Chat Session",l=k(),a=g("main"),U(u.$$.fragment),o=k(),h=g("footer"),U(f.$$.fragment),p(s,"class","back-btn svelte-vs03v3"),p(r,"class","svelte-vs03v3"),p(n,"class","svelte-vs03v3"),p(a,"class","svelte-vs03v3"),p(e,"class","chat-page svelte-vs03v3")},m(_,v){y(_,e,v),d(e,n),d(n,s),d(n,i),d(n,r),d(e,l),d(e,a),O(u,a,null),d(e,o),d(e,h),O(f,h,null),c=!0,m||(b=D(s,"click",t[1]),m=!0)},p(_,[v]){const L={};v&1&&(L.messages=_[0]),u.$set(L)},i(_){c||(E(u.$$.fragment,_),E(f.$$.fragment,_),c=!0)},o(_){C(u.$$.fragment,_),C(f.$$.fragment,_),c=!1},d(_){_&&$(e),A(u),A(f),m=!1,b()}}}function et(t,e,n){let s=[];N.subscribe(r=>{n(0,s=r.messages),r.sessionId}),be(()=>{});function i(){N.reset()}return[s,i]}class tt extends R{constructor(e){super(),B(this,e,et,xe,I,{})}}function nt(t){let e,n;return e=new Qe({}),{c(){U(e.$$.fragment)},m(s,i){O(e,s,i),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){A(e,s)}}}function st(t){let e,n;return e=new tt({}),{c(){U(e.$$.fragment)},m(s,i){O(e,s,i),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){A(e,s)}}}function it(t){let e,n,s,i;const r=[st,nt],l=[];function a(u,o){return u[0]?0:1}return n=a(t),s=l[n]=r[n](t),{c(){e=g("main"),s.c(),p(e,"class","svelte-3p4h8h")},m(u,o){y(u,e,o),l[n].m(e,null),i=!0},p(u,[o]){let h=n;n=a(u),n!==h&&(Le(),C(l[h],1,1,()=>{l[h]=null}),Ee(),s=l[n],s||(s=l[n]=r[n](u),s.c()),E(s,1),s.m(e,null))},i(u){i||(E(s),i=!0)},o(u){C(s),i=!1},d(u){u&&$(e),l[n].d()}}}function rt(t,e,n){let s;return N.subscribe(i=>{n(0,s=i.sessionId)}),[s]}class lt extends R{constructor(e){super(),B(this,e,rt,it,I,{})}}new lt({target:document.getElementById("app")});
